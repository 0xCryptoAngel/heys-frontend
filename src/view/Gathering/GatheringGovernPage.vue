<script lang="ts" setup>
import { ref, watch } from 'vue'
import LayoutDark from '@/layouts/LayoutDark.vue'
import SearchInput from '@/components/ui/SearchInput.vue'
import TagButton from '@/components/atoms/TagButton.vue'
import NavTab from '@/components/atoms/NavTab.vue'
import { Doc, MarketData, Tag } from '../../utils/types'
import useDocs from "../../composables/web2/useDocs";
import HeaderNav from "@/components/layoutElements/HeaderNav.vue";
import HeaderContent from "@/components/layoutElements/HeaderContent.vue";
import Footer from "@/components/layoutElements/Footer.vue";
import VoteTab from "../../components/govern/VoteTab.vue";
import ChatTab from "../../components/govern/ChatTab.vue";
import FinanceTab from "../../components/govern/FinanceTab.vue";
import useTags from '../../composables/web2/useTags'
import useGathering from '../../composables/web2/useGathering'
import {useRoute} from "vue-router";

// consts
const route = useRoute()
const gatheringSlug = route.params.gatheringSlug.toString()
const tabs = ['Vote', 'Chat', 'Finance']

// state
const selectedTab = ref(route?.query?.tab?.toString() ?? 'Vote')

// watchers
watch(selectedTab, (newTab) => {
  window.history.replaceState(
    { page: 'heystacks' },
    'heystacks',
    `/g/${gatheringSlug}/govern?tab=${newTab}`
  )
})

</script>

<template>
  <LayoutDark>
    <template v-slot:header-nav>
      <HeaderNav />
    </template>
    <template v-slot:header-content>
      <HeaderContent :nav-link="{ label: '< Back', path: `/g/${gatheringSlug}` }" />
    </template>
    <template v-slot:command-band>
      <div class="max-w-screen-md mx-auto text-center flex-center">
        <NavTab
          v-for="tab in tabs"
          :key="`tab-${tab}`"
          :text="tab"
          :selected="tab === selectedTab"
          @click="selectedTab = tab"
        />
      </div>
    </template>
    <template v-slot:content>
      <div class="max-w-screen-md mx-auto mb-12 pt-10">
        <VoteTab v-if="selectedTab === 'Vote'" />
        <ChatTab v-if="selectedTab === 'Chat'" />
        <FinanceTab v-if="selectedTab === 'Finance'" />
      </div>
    </template>
    <template v-slot:footer>
      <Footer />
    </template>
  </LayoutDark>
</template>
